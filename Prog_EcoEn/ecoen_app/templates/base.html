<!DOCTYPE html>
<html lang="es">
  <head>
    {% load static %} {% load socialaccount %}

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EcoEn</title>

    <!-- Favicon -->
    <link
      rel="icon"
      type="image/png"
      href="{% static 'images/faviconTT.png' %}"
    />

    <!-- Fuentes -->
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap"
      rel="stylesheet"
    />

    <!-- Bootstrap primero -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Estilos propios DESPUÃ‰S de Bootstrap -->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}" />
    <link rel="stylesheet" href="{% static 'css/chatbot.css' %}" />
    <link rel="stylesheet" href="{% static 'css/animations.css' %}" />
  </head>
  <body class="light-mode">
    <!-- BotÃ³n flotante hamburguesa -->
    <div
      id="menu-toggle"
      onclick="toggleMenu()"
      class="menu-toggle"
      aria-controls="menu-lateral"
      aria-expanded="false"
      aria-label="Abrir menÃº"
    >
      <span id="menu-icon">â˜°</span>
    </div>

    <!-- Overlay -->
    <div id="menu-overlay" class="menu-overlay"></div>

    <!-- MenÃº lateral derecho -->
    <div
      id="menu-lateral"
      class="menu-lateral"
      role="dialog"
      aria-modal="true"
      aria-label="MenÃº lateral"
    >
      <div class="menu-stack">
        {% if user.is_authenticated %}
        <p class="menu-header">ğŸ‘‹ Hola, {{ user.username }}</p>
        <a href="{% url 'custom_logout' %}" class="btn btn-danger"
          >Cerrar sesiÃ³n</a
        >
        {% else %}
        <button onclick="toggleLoginOptions()" class="btn btn-primary">
          ğŸ” Iniciar sesiÃ³n
        </button>
        <div id="login-options" class="collapse-area">
          <a href="{% url 'custom_login' %}" class="btn btn-outline-primary"
            >Iniciar sesiÃ³n con usuario</a
          >
          <p class="text-center mt-2">
            Â¿No tienes una cuenta?
            <a href="{% url 'custom_signup' %}" class="text-success"
              >RegÃ­strate aquÃ­</a
            >
          </p>
        </div>
        {% endif %}

        <a href="{% url 'mi_perfil' %}" class="btn btn-outline-secondary"
          >ğŸ‘¤ Ver perfil</a
        >

        <button onclick="toggleConfig()" class="btn btn-secondary">
          âš™ï¸ ConfiguraciÃ³n
        </button>
        <div id="config-options" class="collapse-area">
          <button onclick="toggleDarkMode()" class="btn btn-dark">
            ğŸŒ™ Modo oscuro / claro
          </button>
        </div>
      </div>
    </div>

    <!-- Header -->
    <header class="text-center p-4 bg-azul">
      {% block header_title %}
      <h1 class="m-0">ğŸŒ± EnergÃ­a Renovable</h1>
      {% endblock %}
    </header>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-azul">
      <div class="container-fluid">
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarEcoEn"
          aria-controls="navbarEcoEn"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarEcoEn">
          <ul class="navbar-nav mx-auto">
            <li class="nav-item">
              <a class="nav-link" href="{% url 'index' %}">Inicio</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'productos' %}">Productos</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#reseÃ±as">ReseÃ±as</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#contacto">Contacto</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Contenido dinÃ¡mico -->
    <main>{% block content %}{% endblock %}</main>

    <!-- =========================
     ECOBOT: BOTÃ“N + PANEL LATERAL
     ========================= -->

    <!-- BotÃ³n flotante con mascotita (abre/cierra el panel) -->
    <div
      id="chatbot-button"
      class="chatbot-icon ecobot-mascot"
      aria-label="Abrir EcoBot"
      title="Abrir EcoBot"
    >
      <img src="{% static 'images/ecobot_mascot.png' %}" alt="EcoBot" />
    </div>

    <!-- Panel lateral vertical (glassmorphism + slide-in) -->
    <!-- IMPORTANTE: arranca oculto, se abre con la clase .show -->
    <div
      id="chatbot-window"
      class="chatbot-window"
      role="dialog"
      aria-label="EcoBot"
      aria-hidden="true"
    >
      <div id="chatbot-header">
        <span>EcoBot ğŸŒ±</span>
        <button id="chatbot-close" aria-label="Cerrar">âœ–</button>
      </div>
      <!-- Ãrea de mensajes -->
      <div id="chatbot-messages" aria-live="polite"></div>

      <!-- Botones rÃ¡pidos iniciales -->
      <div id="chatbot-quick-replies">
        <button data-action="asistencia" style="--i: 1">
          ğŸ”§ Asistencia tÃ©cnica
        </button>
        <button data-action="compra" style="--i: 2">ğŸ›’ Realizar compra</button>
        <button data-action="tips" style="--i: 3">
          ğŸ“˜ Tips de sostenibilidad
        </button>
        <button data-action="horarios" style="--i: 4">ğŸ•˜ Horarios</button>
        <button data-action="envios" style="--i: 5">ğŸ“¦ EnvÃ­os</button>
        <button data-action="precios" style="--i: 6">ğŸ’² Precios</button>
      </div>

      <!-- Input -->
      <div id="chatbot-input-row">
        <input
          id="chatbot-input"
          type="text"
          placeholder="Escribe tu mensaje..."
        />
        <button id="chatbot-send">Enviar</button>
      </div>
    </div>

    <!-- Scripts globales -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'js/chatbot.js' %}" defer></script>

    <script>
      function toggleMenu() {
        const menu = document.getElementById("menu-lateral");
        const overlay = document.getElementById("menu-overlay");
        const toggle = document.getElementById("menu-toggle");
        const body = document.body;

        const isActive = menu.classList.contains("active");

        menu.classList.toggle("active");
        overlay.classList.toggle("active");
        toggle.setAttribute("aria-expanded", !isActive);
        body.classList.toggle("menu-abierto", !isActive);
      }

      function cerrarMenu() {
        document.getElementById("menu-lateral").classList.remove("active");
        document.getElementById("menu-overlay").classList.remove("active");
        document
          .getElementById("menu-toggle")
          .setAttribute("aria-expanded", false);
        document.body.classList.remove("menu-abierto");
      }

      document
        .getElementById("menu-overlay")
        .addEventListener("click", cerrarMenu);
      document.querySelectorAll("#menu-lateral .btn").forEach((btn) => {
        btn.addEventListener("click", cerrarMenu);
      });
    </script>

    <!-- AquÃ­ incluimos el chatbot en TODAS las pÃ¡ginas -->
    {% block extra_scripts %}{% endblock %}
  </body>
</html>
