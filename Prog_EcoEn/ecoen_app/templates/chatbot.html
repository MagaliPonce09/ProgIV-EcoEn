{% extends "base.html" %}
{% load static %}
<script>
  const ecobotAvatar = "{% static 'images/ecobot.png' %}";
  const userAvatar   = "{% static 'images/user.png' %}";
  const soundBubble  = "{% static 'sounds/bubble.mp3' %}";
  const soundMagic   = "{% static 'sounds/magic.mp3' %}";
  const soundRetro   = "{% static 'sounds/retro.mp3' %}";
</script>
{% block content %}

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EcoBot Demo</title>
  <style>
    :root { --green1: #4CAF50; --green2: #81C784; }

    /* BotÃ³n flotante (FAB) */
    #chatbot-icon {
      position: fixed; bottom: 20px; right: 20px;
      background: linear-gradient(135deg, var(--green1), var(--green2));
      color: white; font-size: 24px; border-radius: 50%;
      width: 60px; height: 60px; display: flex; align-items: center; justify-content: center;
      cursor: pointer; box-shadow: 0 6px 16px rgba(0,0,0,0.25); transition: transform 0.2s, background 0.3s;
      z-index: 9999;
    }
    #chatbot-icon:hover { transform: scale(1.08); background: #45a049; }

    /* Ventana de chat con slide-in lateral */
    #chatbot-window {
      position: fixed; bottom: 90px; right: 20px; width: 340px; height: 480px;
      background: rgba(255,255,255,0.15); backdrop-filter: blur(14px);
      border-radius: 18px; box-shadow: 0 10px 28px rgba(0,0,0,0.35);
      display: flex; flex-direction: column; overflow: hidden; z-index: 9999;
      opacity: 0; transform: translateX(120%); pointer-events: none;
      transition: opacity .35s ease-out, transform .35s ease-out;
    }
    #chatbot-window.open { opacity: 1; transform: translateX(0); pointer-events: auto; }

    .chatbot-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 12px 14px; font-weight: 600; background: rgba(76,175,80,0.85);
      color: white; border-bottom: 1px solid rgba(255,255,255,0.3);
    }
    .chatbot-header button {
      background: transparent; border: none; color: white; font-size: 18px; cursor: pointer;
    }

    .chatbot-body {
      flex: 1; overflow-y: auto; padding: 12px; font-size: 14px;
      display: flex; flex-direction: column;
    }
    .msg { margin: 8px 0; padding: 8px 10px; border-radius: 12px; max-width: 85%; }
    .user { background: rgba(76,175,80,0.25); align-self: flex-end; }
    .bot  { background: rgba(255,255,255,0.35); color: #111; align-self: flex-start; }

    .chatbot-footer { display: flex; gap: 8px; padding: 10px; background: rgba(255,255,255,0.18); }
    #chatbot-input { flex: 1; border: none; border-radius: 12px; padding: 10px; outline: none; }
    #chatbot-send { background: var(--green1); color: white; border: none; border-radius: 12px; padding: 8px 14px; cursor: pointer; transition: background 0.3s; }
    #chatbot-send:hover { background: #45a049; }

    .chatbot-buttons { display: flex; gap: 8px; padding: 10px; }
    .chatbot-buttons button { flex: 1; border: none; border-radius: 12px; padding: 8px; cursor: pointer;
      background: rgba(255,255,255,0.25); transition: background 0.3s; }
    .chatbot-buttons button:hover { background: rgba(76,175,80,0.35); }
  </style>
</head>
<body>

  <!-- FAB -->
  <div id="chatbot-icon" aria-expanded="false" title="Abrir chat">ðŸ’¬</div>

  <!-- Ventana -->
  <div id="chatbot-window" aria-hidden="true">
    <div class="chatbot-header">
      <span>EcoBot ðŸŒ±</span>
      <button id="chatbot-close" title="Cerrar">âœ•</button>
    </div>
    <div id="chatbot-body" class="chatbot-body"></div>
   <div class="chatbot-buttons">
  <button data-action="asistencia" style="--i:1">ðŸ”§ Asistencia tÃ©cnica</button>
<button data-action="compra" style="--i:2">ðŸ›’ Realizar compra</button>
<button data-action="tips" style="--i:3">ðŸ“˜ Tips de sostenibilidad</button>
<button data-action="horarios" style="--i:4">ðŸ•˜ Horarios</button>
<button data-action="envios" style="--i:5">ðŸ“¦ EnvÃ­os</button>
<button data-action="precios" style="--i:6">ðŸ’² Precios</button>

</div>

    <div class="chatbot-footer">
      <input type="text" id="chatbot-input" placeholder="Escribe tu pregunta..." />
      <button id="chatbot-send">Enviar</button>
    </div>
  </div>

{% endblock %}

{% block extra_scripts %}
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const icon   = document.getElementById("chatbot-icon");
      const win    = document.getElementById("chatbot-window");
      const body   = document.getElementById("chatbot-body");
      const input  = document.getElementById("chatbot-input");
      const send   = document.getElementById("chatbot-send");
      const close  = document.getElementById("chatbot-close");
      const quicks = document.querySelectorAll(".chatbot-buttons button");

      function toggleChat(open) {
        if (open) {
          win.classList.add("open");
          icon.setAttribute("aria-expanded", "true");
          win.setAttribute("aria-hidden", "false");
          input.focus();
        } else {
          win.classList.remove("open");
          icon.setAttribute("aria-expanded", "false");
          win.setAttribute("aria-hidden", "true");
        }
      }

      icon.addEventListener("click", () => toggleChat(!win.classList.contains("open")));
      close.addEventListener("click", () => toggleChat(false));

      function appendMsg(text, who = "bot") {
        const div = document.createElement("div");
        div.className = `msg ${who}`;
        div.textContent = text;
        body.appendChild(div);
        body.scrollTop = body.scrollHeight;
      }

      // ðŸ”§ NUEVO: array de tips ecolÃ³gicos
      const tips = [
        "ðŸŒ± Usa bolsas reutilizables en lugar de plÃ¡sticas.",
        "ðŸ’¡ Apaga las luces cuando no las necesites.",
        "ðŸš² Opta por la bicicleta para trayectos cortos.",
        "â™»ï¸ Separa residuos reciclables en tu hogar.",
        "ðŸŒ Reduce el consumo de agua cerrando la canilla al cepillarte."
      ];
      function obtenerTipEcologico() {
        const randomIndex = Math.floor(Math.random() * tips.length);
        return tips[randomIndex];
      }

      // ðŸ”§ NUEVO: respuestas predefinidas con includes
      function replyFor(text) {
  const t = text.toLowerCase();

  if (t.includes("energÃ­a") || t.includes("energia")) {
    return "ðŸ’¡ Tip: Cambia a LED, usa regletas con interruptor y programa horarios de uso.";
  }
  if (t.includes("asistencia") || t.includes("soporte")) {
    return "ðŸ”§ Asistencia: DescrÃ­beme el problema o contacta soporte@EcoEn.com.";
  }
  if (t.includes("horario")) {
    return "ðŸ•˜ Horarios: Atendemos de lunes a viernes de 9 a 18 hs.";
  }
  if (t.includes("envio") || t.includes("envÃ­os")) {
    return "ðŸ“¦ EnvÃ­os: Realizamos envÃ­os a todo el paÃ­s en 5 a 7 dÃ­as hÃ¡biles.";
  }
  if (t.includes("precio") || t.includes("precios")) {
    return "ðŸ’² El precio depende del catÃ¡logo, consulta nuestra tienda online.";
  }
  if (t.includes("gracias")) {
    return "ðŸ¤ Â¡De nada! Siempre a tu servicio.";
  }

  // Si no coincide con nada, devuelve tip ecolÃ³gico aleatorio
  return obtenerTipEcologico();
}

      function sendMessage() {
        const msg = input.value.trim();
        if (!msg) return;
        appendMsg(`ðŸ‘¤ ${msg}`, "user");
        input.value = "";
        setTimeout(() => appendMsg(`ðŸ¤– ${replyFor(msg)}`, "bot"), 500);
      }

      send.addEventListener("click", sendMessage);
      input.addEventListener("keydown", (e) => { if (e.key === "Enter") sendMessage(); });
      quicks.forEach(b => b.addEventListener("click", () => { input.value = b.dataset.quick; sendMessage(); }));

      // Mensaje de bienvenida
      appendMsg("Hola, soy EcoBotðŸŒ±, Â¿En quÃ© puedo ayudarte hoy?", "bot");
    });
  </script>
{% endblock %}

  
</body>
</html>




