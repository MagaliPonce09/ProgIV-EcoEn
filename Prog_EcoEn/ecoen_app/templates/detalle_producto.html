{% extends "base.html" %}
{% block content %}
<section class="container py-5">
  <div class="row">
    <div class="col-md-6">
      <img src="{{ producto.imagen.url }}" class="img-fluid rounded shadow" alt="{{ producto.nombre }}">
    </div>
    <div class="col-md-6">
      <h2 class="fw-bold">{{ producto.nombre }}</h2>
      <p class="lead">{{ producto.descripcion }}</p>
      <p class="text-success fw-bold">Precio: ${{ producto.precio|floatformat:0 }} ARS</p>
      <p class="text-warning">‚≠ê Promedio: {{ producto.promedio_puntuacion }} / 5</p>

      <!-- Rating interactivo -->
      <div class="rating mb-3">
        {% for i in "12345" %}
          {% with val=i|stringformat:"i" %}
            <span class="star {% if puntuacion_usuario|stringformat:"s" >= val %}selected{% endif %}" 
                  data-value="{{ val }}" role="button" aria-label="Calificar {{ val }} estrellas">‚òÖ</span>
          {% endwith %}
        {% endfor %}
      </div>

      <div class="d-flex gap-2">
        <button class="btn btn-outline-success add-to-cart"
                data-product="{{ producto.nombre }}"
                data-price="{{ producto.precio }}"
                data-product-id="{{ producto.id }}">
          üõí Agregar al carrito
        </button>
        <a href="{% url 'productos' %}" class="btn btn-secondary">‚¨Ö Volver</a>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    // Carrito
    const boton = document.querySelector(".add-to-cart");
    boton.addEventListener("click", () => {
      const nombre = boton.dataset.product;
      const precio = parseFloat(boton.dataset.price);
      const id = boton.dataset.productId;

      let carrito = JSON.parse(localStorage.getItem("carrito")) || [];
      let existente = carrito.find(item => item.id === id);

      if (existente) {
        existente.cantidad += 1;
      } else {
        carrito.push({ id, nombre, precio, cantidad: 1 });
      }

      localStorage.setItem("carrito", JSON.stringify(carrito));
      alert(`${nombre} agregado al carrito ‚úÖ`);
    });

    // Rating interactivo
    const estrellas = document.querySelectorAll(".star");
    estrellas.forEach(star => {
      star.addEventListener("click", () => {
        estrellas.forEach(s => s.classList.remove("selected"));
        star.classList.add("selected");
        alert(`Calificaste con ${star.dataset.value} ‚≠ê`);
        // Aqu√≠ podr√≠as enviar la puntuaci√≥n al backend v√≠a AJAX
      });
    });
  });
</script>
{% endblock %}
